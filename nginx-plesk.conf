# Nginx Configuration για Plesk
# Προσθέστε αυτό στο: Plesk → billiardtoday.com → Apache & nginx Settings → Additional nginx directives

# Reverse proxy για το Next.js app στο /tournaments
location /tournaments {
    proxy_pass http://localhost:3022;
    proxy_http_version 1.1;
    
    # WebSocket support
    proxy_set_header Upgrade $http_upgrade;
    proxy_set_header Connection 'upgrade';
    
    # Headers
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header X-Forwarded-Proto $scheme;
    proxy_set_header X-Forwarded-Host $host;
    
    # Bypass cache για upgrades
    proxy_cache_bypass $http_upgrade;
    
    # Timeouts
    proxy_connect_timeout 60s;
    proxy_send_timeout 60s;
    proxy_read_timeout 60s;
    
    # Buffer settings
    proxy_buffering on;
    proxy_buffer_size 4k;
    proxy_buffers 8 4k;
    proxy_busy_buffers_size 8k;
}

# Next.js static assets - με aggressive caching
location /_next/static {
    proxy_pass http://localhost:3022/_next/static;
    proxy_http_version 1.1;
    proxy_set_header Host $host;
    
    # Cache για 1 χρόνο (immutable assets)
    expires 365d;
    add_header Cache-Control "public, immutable";
    
    # Compression
    gzip on;
    gzip_types text/css application/javascript application/json;
    gzip_vary on;
}

# Next.js image optimization
location /_next/image {
    proxy_pass http://localhost:3022/_next/image;
    proxy_http_version 1.1;
    proxy_set_header Host $host;
    
    # Cache για 30 μέρες
    expires 30d;
    add_header Cache-Control "public, max-age=2592000";
}

# Next.js data files
location /_next/data {
    proxy_pass http://localhost:3022/_next/data;
    proxy_http_version 1.1;
    proxy_set_header Host $host;
    
    # Shorter cache για data
    expires 1h;
    add_header Cache-Control "public, max-age=3600, must-revalidate";
}

# Favicon και static files στο root του tournaments
location ~ ^/tournaments/(favicon\.ico|robots\.txt|sitemap\.xml)$ {
    proxy_pass http://localhost:3022;
    proxy_http_version 1.1;
    proxy_set_header Host $host;
    
    expires 7d;
    add_header Cache-Control "public, max-age=604800";
}
